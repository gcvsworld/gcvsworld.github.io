---
title: 为什么以及如何要避免浏览器的重绘和重排
date: 2022-11-14 18:49:36
tags:
  - http
---

*天气：🌤*

## why?

![image](https://thumbnail0.baidupcs.com/thumbnail/f9f9ea445j2b610a5e4c259fdd6a5a1a?fid=3031270481-250528-879925807575283&time=1668427200&rt=sh&sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-cVBdQUjVVfxljxXT7HnrHjqMp90%3D&expires=8h&chkv=0&chkbd=0&chkpc=&dp-logid=454455358293489033&dp-callid=0&file_type=0&size=c710_u400&quality=100&vuk=-&ft=video)

*重排和重绘都会占用主线程，JavaScript也是运行在主线程上的，会出现抢占时间的问题，如果有一个不断重排重绘的动画，那么浏览器需要在每一帧都运行样式，来进行布局和绘制的操作，当浏览器以60帧每秒的刷新运行时才不会让使用者感觉到卡顿，如果运行动画的同时还有大量js任务，当在一帧的时间内布局和绘制结束后还有剩余时间，JS就会拿到主线程的使用权，如果JS执行时间过长就会导致在下一帧开始时JS没有及时归还主线程，导致下一帧动画没有按时渲染，就会出现页面动画的卡顿*

---

## 如何避免

![image](https://thumbnail0.baidupcs.com/thumbnail/5d8f597e5heaf19e29975895dc62f208?fid=3031270481-250528-18573261279814&time=1668427200&rt=sh&sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-812QjpAHvjQIoeCIj5ycv6sSJbU%3D&expires=8h&chkv=0&chkbd=0&chkpc=&dp-logid=454460565545273102&dp-callid=0&file_type=0&size=c710_u400&quality=100&vuk=-&ft=video)

*通过这个api，这个方法会在每一帧被调用，通过api的回调，把JS运行任务分到每一帧，在每一帧时间用完前暂停JS执行归还主线程，这样在下一帧开始时主线程就可以按时执行布局和绘制*

> 如：React Fiber

![image](https://thumbnail0.baidupcs.com/thumbnail/5d8955378tb1c3574a6b8d1ccb3d1096?fid=3031270481-250528-189013219464618&time=1668427200&rt=sh&sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-onwdOSP2yUrtcS5u9QAv%2F55E6bU%3D&expires=8h&chkv=0&chkbd=0&chkpc=&dp-logid=454463483851697817&dp-callid=0&file_type=0&size=c710_u400&quality=100&vuk=-&ft=video)

*格化并不占用主线程  css有个动画属性叫做transfrom,通过该属性实现的动画不会经过布局和绘制，而是直接运行在合成器线程和栅格线程中，不会受到主线程中JS执行的影响*
